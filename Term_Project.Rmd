---
title: "Term Project"
author: "Leslie Speight Youtsey and Elizabeth Weatherup"
date: "10/22/2020"
output:
  pdf_document: default
  html_document: default
---

```{r}
bats_flux <- read.csv("bats_flux.csv")

delete.na <- function(DF, n=0) {
  DF[rowSums(is.na(DF)) <= n,]
} #Function that takes rows out that contains NAs 

bats_flux.noNA <- delete.na(bats_flux) # Take out rows containing NAs 


Data <- subset(bats_flux,select = c("cr","dep","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2","M_avg","C_avg","N_avg","P_avg"))

Data.noNA <- delete.na(Data)

#Data_noNA <- write.csv(x= Data.noNA,file = "Data_noNA.csv")
```


ANOVA Trial 
```{r}
#we want to make predictions on the Mass average flux. 

# we want to compare this against depth and C,N,P fluxes 

# Depth is categorical 
# N,P,C are numerical 

library(psych) # for `pairs.panels()`
library(lattice)

ANOCOVA.data <- subset(Data.noNA, select = c("dep", "M_avg", "C_avg","N_avg","P_avg"))
as.character(ANOCOVA.data$dep) # need to make dep categorical not numerical 
attach(ANOCOVA.data)

summary(ANOCOVA.data)

pairs.panels(data.frame(dep,C_avg,N_avg, P_avg, M_avg))

xyplot(M_avg ~ C_avg | dep, 
                  main="Fig2a: Activity level-specific scatterplots"
           )

    xyplot(M_avg ~ C_avg, groups=dep, 
                  auto.key=TRUE,
                  main="Fig2b: Scatterplot with color=group level"
           )
    
    xyplot(M_avg ~ C_avg, groups=dep, 
                  type=c("p","r"), # `p` for _points_, `r` for _regression line_
                                   # see https://stackoverflow.com/questions/12972039/plotting-xyplot-with-regression-line-on-lattice-graphics for more
                  auto.key=TRUE,
                  main="Fig3: Three standalone depth level-specific `lm()` fits"
           )
```

Bar graph trial
```{r}
# this code is to specify the depth I want to look at that contains the rows and the columns
Study_depths <- c("150", "200", "300", "400" ) #vector of depths I want to retain

Study_Rows <- which(bats_flux$dep %in% Study_depths) #which() to ask R which rows in spp name are on the list


bats_flux2 <- bats_flux[Study_Rows,] #has all the rows we want as well as all the columns

```


Mean and se of each depth of C-flux


```{r}
Cflux <- bats_flux2[-which(is.na(bats_flux2$C_avg)),] #removes na from C-avg
Cflux.noNAs <- delete.na(bats_flux2)

levels(as.factor(Cflux.noNAs$dep150)) #this looks at the distribution of toxins in the organism selected


dep150 <- subset(Cflux.noNAs, dep=="150") #focusing on mean of C-avg at depth 150
dep150

muCflux150 <- mean(dep150$C_avg, data=dep150)
muCflux150

s.e150 <- muCflux150 * sqrt(10)


dep200 <- subset(Cflux.noNAs, dep=="200") #focusing on mean of C-avg at depth 200
dep200

muCflux200 <- mean(dep200$C_avg, data=dep200)
muCflux200

dep300 <- subset(Cflux.noNAs, dep=="300") #focusing on mean of C-avg at depth 300
dep300

muCflux300 <- mean(dep300$C_avg, data=dep300)
muCflux300

dep400 <- subset(Cflux.noNAs, dep=="400") #focusing on mean of C-avg at depth 400
dep400

muCflux400 <- mean(dep400$C_avg, data=dep400)
muCflux400

```

```{r}
site.freq <- table(bats_flux2$dep) #Creates table with frequency of each Site
site.freq

barplot(site.freq)


barplot(site.freq[order(site.freq, decreasing = T)],
        horiz = F,         #Horizontal
        border = NA,    
        
        main = "Average C Flux at Depths: 150, 200, 300, 400",
        xlab = "Depths", ylab = "Average C Flux")


```









Looking at fluxes over depths and hypothesizing that flux will decrease over depth 
```{r}
# separate each flux into its own dataframe 
# delete rows that contain NAs 
C_flux.data <- delete.na(subset(Data,select = c("cr","dep","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2","C_avg")))
N_flux.data <- delete.na(subset(Data,select = c("cr","dep","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2","N_avg")))
P_flux.data <- delete.na(subset(Data,select = c("cr","dep","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2","P_avg")))
M_flux.data <- delete.na(subset(Data,select = c("cr","dep","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2","M_avg")))
```

```{r}
# Subset each depth and rename columns 
library(plyr)
C_flux.depth.150 <- subset(C_flux.data, dep == 150)
C_flux.depth.150 <- rename(C_flux.depth.150, c("dep"="dep.150"))
C_flux.depth.150 <- rename(C_flux.depth.150, c("C_avg" ="C_avg.150"))
C_flux.depth.200 <- subset(C_flux.data, dep == 200)
C_flux.depth.200 <- rename(C_flux.depth.200, c("dep"="dep.200"))
C_flux.depth.200 <- rename(C_flux.depth.200, c("C_avg" ="C_avg.200"))
C_flux.depth.300 <- subset(C_flux.data, dep == 300)
C_flux.depth.300 <- rename(C_flux.depth.300, c("dep"="dep.300"))
C_flux.depth.300 <- rename(C_flux.depth.300, c("C_avg" ="C_avg.300"))
C_flux.depth.400 <- subset(C_flux.data, dep == 400)
C_flux.depth.400 <- rename(C_flux.depth.400, c("dep"="dep.400"))
C_flux.depth.400 <- rename(C_flux.depth.400, c("C_avg" ="C_avg.400"))
```

```{r}
N_flux.depth.150 <- subset(N_flux.data, dep == 150)
N_flux.depth.150 <- rename(N_flux.depth.150, c("dep"="dep.150"))
N_flux.depth.150 <- rename(N_flux.depth.150, c("N_avg" ="N_avg.150"))
N_flux.depth.200 <- subset(N_flux.data, dep == 200)
N_flux.depth.200 <- rename(N_flux.depth.200, c("dep"="dep.200"))
N_flux.depth.200 <- rename(N_flux.depth.200, c("N_avg" ="N_avg.200"))
N_flux.depth.300 <- subset(N_flux.data, dep == 300)
N_flux.depth.300 <- rename(N_flux.depth.300, c("dep"="dep.300"))
N_flux.depth.300 <- rename(N_flux.depth.300, c("N_avg" ="N_avg.300"))
N_flux.depth.400 <- subset(N_flux.data, dep == 400)
N_flux.depth.400 <- rename(N_flux.depth.400, c("dep"="dep.400"))
N_flux.depth.400 <- rename(N_flux.depth.400, c("N_avg" ="N_avg.400"))
```

```{r}
P_flux.depth.150 <- subset(P_flux.data, dep == 150)
P_flux.depth.150 <- rename(P_flux.depth.150, c("dep"="dep.150"))
P_flux.depth.150 <- rename(P_flux.depth.150, c("P_avg" ="P_avg.150"))
P_flux.depth.200 <- subset(P_flux.data, dep == 200)
P_flux.depth.200 <- rename(P_flux.depth.200, c("dep"="dep.200"))
P_flux.depth.200 <- rename(P_flux.depth.200, c("P_avg" ="P_avg.200"))
P_flux.depth.300 <- subset(P_flux.data, dep == 300)
P_flux.depth.300 <- rename(P_flux.depth.300, c("dep"="dep.300"))
P_flux.depth.300 <- rename(P_flux.depth.300, c("P_avg" ="P_avg.300"))
P_flux.depth.400 <- subset(P_flux.data, dep == 400)
P_flux.depth.400 <- rename(P_flux.depth.400, c("dep"="dep.400"))
P_flux.depth.400 <- rename(P_flux.depth.400, c("P_avg" ="P_avg.400"))
```

```{r}
M_flux.depth.150 <- subset(M_flux.data, dep == 150)
M_flux.depth.150 <- rename(M_flux.depth.150, c("dep"="dep.150"))
M_flux.depth.150 <- rename(M_flux.depth.150, c("M_avg" ="M_avg.150"))
M_flux.depth.200 <- subset(M_flux.data, dep == 200)
M_flux.depth.200 <- rename(M_flux.depth.200, c("dep"="dep.200"))
M_flux.depth.200 <- rename(M_flux.depth.200, c("M_avg" ="M_avg.200"))
M_flux.depth.300 <- subset(M_flux.data, dep == 300)
M_flux.depth.300 <- rename(M_flux.depth.300, c("dep"="dep.300"))
M_flux.depth.300 <- rename(M_flux.depth.300, c("M_avg" ="M_avg.300"))
M_flux.depth.400 <- subset(M_flux.data, dep == 400)
M_flux.depth.400 <- rename(M_flux.depth.400, c("dep"="dep.400"))
M_flux.depth.400 <- rename(M_flux.depth.400, c("M_avg" ="M_avg.400"))
```


Paired sample t test for each depth and the depth below it 
*This is a paired test because some samples were collected on the same cruise and at the same location. So for each flux value at one depth, there was a flux value collected at a different depth at the same location!
* Data frames were merged based on cruise, year, and location to have the same number of values.  

<br>

(1.1)

$\mu_1$ = mean Carbon flux at depth 150
$\mu_2$ = mean Carbon flux at depth 200

$H_0$ : Carbon flux does not change between 150 and 200 meter. $\mu_1$ = $\mu_2$
$H_1$ : Carbon flux is lower at 200 meter then at 150 meter. $\mu_1$ > $\mu_2$

```{r}
C.depth.150.200 <- merge(C_flux.depth.150,C_flux.depth.200,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(C.depth.150.200$C_avg.150 ,C.depth.150.200$C_avg.200, alternative = "greater", paired = TRUE, var.equal = TRUE)

```

(1.2)

$\mu_1$ = mean Carbon flux at depth 200
$\mu_2$ = mean Carbon flux at depth 300

$H_0$ : Carbon flux does not change between 200 and 300 meter. $\mu_1$ = $\mu_2$
$H_1$ : Carbon flux is lower at 300 meter then at 200 meter. $\mu_1$ > $\mu_2$

```{r}
C.depth.200.300 <- merge(C_flux.depth.200,C_flux.depth.300,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(C.depth.200.300$C_avg.200 ,C.depth.200.300$C_avg.300, alternative = "greater", paired = TRUE, var.equal = TRUE)
```

(1.3)

$\mu_1$ = mean Carbon flux at depth 300
$\mu_2$ = mean Carbon flux at depth 400

$H_0$ : Carbon flux does not change between 300 and 400 meter. $\mu_1$ = $\mu_2$
$H_1$ : Carbon flux is lower at 400 meter then at 300 meter. $\mu_1$ > $\mu_2$

```{r}
C.depth.300.400 <- merge(C_flux.depth.300,C_flux.depth.400,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(C.depth.300.400$C_avg.300 ,C.depth.300.400$C_avg.400, alternative = "greater", paired = TRUE, var.equal = TRUE)
```

(2.1)

$\mu_1$ = mean Nitrogen flux at depth 150
$\mu_2$ = mean Nitrogen flux at depth 200

$H_0$ : Nitrogen flux does not change between 150 and 200 meter. $\mu_1$ = $\mu_2$
$H_1$ : Nitrogen flux is lower at 200 meter then at 150 meter. $\mu_1$ > $\mu_2$

```{r}
N.depth.150.200 <- merge(N_flux.depth.150,N_flux.depth.200,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(N.depth.150.200$N_avg.150 ,N.depth.150.200$N_avg.200, alternative = "greater", paired = TRUE, var.equal = TRUE)

```

(2.2)

$\mu_1$ = mean Nitrogen flux at depth 200
$\mu_2$ = mean Nitrogen flux at depth 300

$H_0$ : Nitrogen flux does not change between 200 and 300 meter. $\mu_1$ = $\mu_2$
$H_1$ : Nitrogen flux is lower at 300 meter then at 200 meter. $\mu_1$ > $\mu_2$

```{r}
N.depth.200.300 <- merge(N_flux.depth.200,N_flux.depth.300,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(N.depth.200.300$N_avg.200 ,N.depth.200.300$N_avg.300, alternative = "greater", paired = TRUE, var.equal = TRUE)
```


(2.3)

$\mu_1$ = mean Nitrogen flux at depth 300
$\mu_2$ = mean Nitrogen flux at depth 400

$H_0$ : Nitrogen flux does not change between 300 and 400 meter. $\mu_1$ = $\mu_2$
$H_1$ : Nitrogen flux is lower at 400 meter then at 300 meter. $\mu_1$ > $\mu_2$

```{r}
N.depth.300.400 <- merge(N_flux.depth.300,N_flux.depth.400,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(N.depth.300.400$N_avg.300 ,N.depth.300.400$N_avg.400, alternative = "greater", paired = TRUE, var.equal = TRUE)
```

<br>

(3.1)

$\mu_1$ = mean Phosporous flux at depth 150
$\mu_2$ = mean Phosporous flux at depth 200

$H_0$ : Phosporous flux does not change between 150 and 200 meter. $\mu_1$ = $\mu_2$
$H_1$ : Phosporous flux is lower at 200 meter then at 150 meter. $\mu_1$ > $\mu_2$

```{r}
P.depth.150.200 <- merge(P_flux.depth.150,P_flux.depth.200,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(P.depth.150.200$P_avg.150 ,P.depth.150.200$P_avg.200, alternative = "greater", paired = TRUE, var.equal = TRUE)

```

(3.2)

$\mu_1$ = mean Phosporous flux at depth 200
$\mu_2$ = mean Phosporous flux at depth 300

$H_0$ : Phosporous flux does not change between 200 and 300 meter. $\mu_1$ = $\mu_2$
$H_1$ : Phosporous flux is lower at 300 meter then at 200 meter. $\mu_1$ > $\mu_2$

```{r}
P.depth.200.300 <- merge(P_flux.depth.200,P_flux.depth.300,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(P.depth.200.300$P_avg.200 ,P.depth.200.300$P_avg.300, alternative = "greater", paired = TRUE, var.equal = TRUE)
```

<br>

(4.1)

$\mu_1$ = mean Mass flux at depth 150
$\mu_2$ = mean Mass flux at depth 200

$H_0$ : Mass flux does not change between 150 and 200 meter. $\mu_1$ = $\mu_2$
$H_1$ : Mass flux is lower at 200 meter then at 150 meter. $\mu_1$ > $\mu_2$

```{r}
M.depth.150.200 <- merge(M_flux.depth.150,M_flux.depth.200,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(M.depth.150.200$M_avg.150 ,M.depth.150.200$M_avg.200, alternative = "greater", paired = TRUE, var.equal = TRUE)

```

(4.2)

$\mu_1$ = mean Mass flux at depth 200
$\mu_2$ = mean Mass flux at depth 300

$H_0$ : Mass flux does not change between 200 and 300 meter. $\mu_1$ = $\mu_2$
$H_1$ : Mass flux is lower at 300 meter then at 200 meter. $\mu_1$ > $\mu_2$

```{r}
M.depth.200.300 <- merge(M_flux.depth.200,M_flux.depth.300,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(M.depth.200.300$M_avg.200 ,M.depth.200.300$M_avg.300, alternative = "greater", paired = TRUE, var.equal = TRUE)
```

(4.3)

$\mu_1$ = mean Mass flux at depth 300
$\mu_2$ = mean Mass flux at depth 400

$H_0$ : Mass flux does not change between 300 and 400 meter. $\mu_1$ = $\mu_2$
$H_1$ : Mass flux is lower at 400 meter then at 300 meter. $\mu_1$ > $\mu_2$

```{r}
M.depth.300.400 <- merge(M_flux.depth.300,M_flux.depth.400,by = c("cr","yymmdd1","yymmdd2","Lat2","Lat2.1","Long1","Long2"))

t.test(M.depth.300.400$M_avg.300 ,M.depth.300.400$M_avg.400, alternative = "greater", paired = TRUE, var.equal = TRUE)
```


# Title : Analyze water quality data 

# Abstract: So this project will involve bla bla bla 

# Introduction: 

# Toolbox discussion:

# Description:

# Implementation:

# Results discussion:

# Limitations:

# References:

